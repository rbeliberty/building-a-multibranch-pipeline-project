ARG PHP_VERSION=7.4
ARG NGINX_VERSION=1.17

############################################################################################################ "php" stage
FROM php:${PHP_VERSION}-fpm AS symfony_php

WORKDIR /srv/app

COPY . .


########################################################################################################## "nginx" stage
# depends on the "php" stage above
FROM nginx:${NGINX_VERSION} AS symfony_nginx
RUN rm /etc/nginx/conf.d/default.conf
COPY docker/nginx/default.conf /etc/nginx/conf.d/

WORKDIR /srv/app

COPY --from=symfony_php /srv/app/public public/

VOLUME /srv/app
VOLUME /etc/nginx/conf.d

